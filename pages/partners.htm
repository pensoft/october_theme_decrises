url = "/partners"
layout = "default"
title = "Partners"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"
==
<?php
use Pensoft\Partners\Models\Partners;
use Pensoft\Cardprofiles\Models\Profiles;

function onStart(){
	$this['partners'] =  Partners::where('type', 1)->get();
    $this['members'] = Profiles::where('category_id',  2)->get();


    $this['insider_members'] = new class {

    public function getIM($id) {
        return Profiles::where('partner_id', $id)->where('category_id',  2)->get();
        }
    };
}

function onPartners(){
    $this['partners'] = [];
    if(post('code')){
        $this['partners'] =  Partners::whereRaw('country_code ILIKE \'%'.post('code').'%\'')->where('type', 1)->get();
    }
    $this['insider_members'] = new class {
        public function getIM($id) {
            return Profiles::where('partner_id', $id)->where('category_id',  2)->get();
        }
    };
}

function onSinglePartner(){
$this['partners'] = [];
if(post('partner_id')){
$this['partners'] =  Partners::where('id', post('partner_id'))->where('type', 1)->get();
}
$this['insider_members'] = new class {
public function getIM($id) {
return Profiles::where('partner_id', $id)->where('category_id',  2)->get();
}
};
}
?>
==
<section class="container tabs_container" role="region" aria-labelledby="partners-heading">
    <h2 id="partners-heading" class="sr-only">Project Partners</h2>
    <div class="tabs" role="tablist" aria-label="Partner view options">
        <a class="" href="#listView" role="tab" aria-selected="true" aria-controls="listView" id="tab-list">{{'List view'|_}}</a>
        <a class="" href="#mapView" role="tab" aria-selected="false" aria-controls="mapView" id="tab-map">{{'Show on map'|_}}</a>
    </div>
</section>

<div class="container" style="padding-top: 0;">
    <div class="row start-md center-xs partner_items_row" id="listView" role="tabpanel" aria-labelledby="tab-list">
        {% for k, partner in partners %}
            <article class="partner-item" role="article" tabindex="0" aria-labelledby="partner-title-{{k}}">
                <img src="{{partner.cover.path}}"
                     title="{{partner.instituion}}"
                     alt="{{partner.instituion}} logo">
                <div class="overlay">
                    <div class="partner_title" id="partner-title-{{k}}">{{partner.instituion}}</div>
                    <div class="read_more_container">
                        <a data-toggle="modal"
                           href="#partner{{k}}"
                           class="read_more"
                           aria-label="Read more about {{partner.instituion}}"
                           role="button">{{'Read more'|_}}</a>
                    </div>
                </div>
            </article>
            <div class="control-popup modal fade"
                 id="partner{{k}}"
                 tabindex="-1"
                 role="dialog"
                 aria-labelledby="modal-title-{{k}}"
                 aria-describedby="modal-content-{{k}}"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content center-xs">
                        <button type="button"
                                class="close"
                                data-dismiss="modal"
                                aria-label="Close partner information dialog">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" aria-hidden="true">
                                <path d="M16.3887 0.290956L9.00094 7.67954L1.61314 0.290956C1.43545 0.128339 1.20188 0.0405543 0.961087 0.0458903C0.72029 0.0512262 0.490836 0.149271 0.320525 0.3196C0.150215 0.489929 0.0521799 0.719407 0.0468446 0.96023C0.0415092 1.20105 0.129284 1.43465 0.291884 1.61235L7.67593 9.00094L0.29001 16.3876C0.199776 16.4736 0.127643 16.5768 0.0778516 16.6911C0.0280603 16.8054 0.00161536 16.9285 7.17197e-05 17.0531C-0.00147192 17.1778 0.0219169 17.3015 0.0688628 17.417C0.115809 17.5324 0.185364 17.6374 0.273442 17.7256C0.361519 17.8138 0.46634 17.8835 0.581743 17.9306C0.697146 17.9777 0.820803 18.0013 0.945444 17.9999C1.07008 17.9986 1.19319 17.9723 1.30754 17.9227C1.42188 17.873 1.52515 17.801 1.61127 17.7109L9.00094 10.3242L16.3887 17.7128C16.5664 17.8754 16.8 17.9632 17.0408 17.9579C17.2816 17.9525 17.511 17.8545 17.6813 17.6842C17.8517 17.5138 17.9497 17.2843 17.955 17.0435C17.9604 16.8027 17.8726 16.5691 17.71 16.3914L10.3222 9.00281L17.71 1.61235C17.8002 1.52635 17.8724 1.42318 17.9221 1.30889C17.9719 1.19461 17.9984 1.07152 17.9999 0.94687C18.0015 0.822218 17.9781 0.698515 17.9311 0.583033C17.8842 0.467551 17.8146 0.36262 17.7266 0.274408C17.6385 0.186196 17.5337 0.116484 17.4183 0.0693699C17.3029 0.0222553 17.1792 -0.00131087 17.0546 5.62491e-05C16.9299 0.00142337 16.8068 0.0276964 16.6925 0.077331C16.5781 0.126966 16.4749 0.19896 16.3887 0.289082V0.290956Z" fill="#0D4C8B"/>
                            </svg>
                        </button>

                        <div class="row" id="modal-content-{{k}}">
                            <div class="col-md-5 col-xs-12 additiona_image_background">
                                <img src="{{partner.background.path}}" alt="{{partner.instituion}} detailed image">
                                <div class="title_and_link">
                                    <div class="partner_title" id="modal-title-{{k}}">{{partner.instituion}}</div>
                                    <div class="partner_link">
                                        <a href="{{partner.instituion_url}}"
                                           class="btn btn-primary"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           aria-label="Visit {{partner.instituion}} website (opens in new window)">{{'Visit website'|_}}</a>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-7 col-xs-12 partner_detailed_info">
                                {% if insider_members.getIM(partner.id).count > 0 %}
                                <section role="region" aria-labelledby="members-heading-{{k}}">
                                    <h3 id="members-heading-{{k}}">{{'Members'|_}}</h3>
                                    <div class="partners_list_content">
                                        {% for profile in insider_members.getIM(partner.id) %}
                                        <article class="contact_info row" role="article" aria-labelledby="member-name-{{k}}-{{loop.index}}">
                                            <div class="col-md-3 col-xs-12 coordinator_image">
                                                {% if profile.avatar %}
                                                <img alt="Photo of {{ profile.names }}" src="{{profile.avatar|crop_image}}">
                                                {% else %}
                                                <img alt="Default avatar for {{ profile.names }}" src="{{ 'avatar.svg'|media }}" width="82" height="67" class="no-image">
                                                {% endif %}
                                            </div>
                                            <div class="col-md-6 col-xs-12 coordinator_info">
                                                <div class="">
                                                    <h4 id="member-name-{{k}}-{{loop.index}}">{{ profile.names }}</h4>
                                                    {% if profile.email %}
                                                    <div class="position">
                                                        <a href="mailto:{{ profile.email }}"
                                                           target="_blank"
                                                           aria-label="Send email to {{ profile.names }}">{{ profile.email }}</a>
                                                    </div>
                                                    {% endif %}
                                                    {% if profile.position %} <div class="position">{{ profile.position }}</div>{% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-xs-12">
                                                    <p class="read-more"
                                                       onclick="expandBiography(this);"
                                                       aria-expanded="false"
                                                       aria-controls="bio-{{k}}-{{loop.index}}"
                                                       aria-label="Read biography of {{ profile.names }}">{{'Read more'|_}}</p>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="body"
                                                     id="bio-{{k}}-{{loop.index}}"
                                                     style="display: none;"
                                                     role="region"
                                                     aria-labelledby="member-name-{{k}}-{{loop.index}}">{{ profile.content|raw }}</div>
                                            </div>
                                        </article>
                                            {% endfor %}
                                    </div>
                                </section>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>


    <div class="row start-md center-xs partner_items_row" id="mapView" role="tabpanel" aria-labelledby="tab-map" aria-hidden="true">
        <span class="tooltiptext" id="tooltip" aria-live="polite">Bulgaria</span>
        {% partial 'map_partners' %}

        {% for k, partner in partners %}
        <div class="control-popup modal fade"
             id="instituion{{partner.id}}"
             tabindex="-1"
             role="dialog"
             aria-labelledby="map-modal-title-{{k}}"
             aria-describedby="map-modal-content-{{k}}"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content center-xs">
                    <button type="button"
                            class="close"
                            data-dismiss="modal"
                            aria-label="Close partner information dialog">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" aria-hidden="true">
                            <path d="M16.3887 0.290956L9.00094 7.67954L1.61314 0.290956C1.43545 0.128339 1.20188 0.0405543 0.961087 0.0458903C0.72029 0.0512262 0.490836 0.149271 0.320525 0.3196C0.150215 0.489929 0.0521799 0.719407 0.0468446 0.96023C0.0415092 1.20105 0.129284 1.43465 0.291884 1.61235L7.67593 9.00094L0.29001 16.3876C0.199776 16.4736 0.127643 16.5768 0.0778516 16.6911C0.0280603 16.8054 0.00161536 16.9285 7.17197e-05 17.0531C-0.00147192 17.1778 0.0219169 17.3015 0.0688628 17.417C0.115809 17.5324 0.185364 17.6374 0.273442 17.7256C0.361519 17.8138 0.46634 17.8835 0.581743 17.9306C0.697146 17.9777 0.820803 18.0013 0.945444 17.9999C1.07008 17.9986 1.19319 17.9723 1.30754 17.9227C1.42188 17.873 1.52515 17.801 1.61127 17.7109L9.00094 10.3242L16.3887 17.7128C16.5664 17.8754 16.8 17.9632 17.0408 17.9579C17.2816 17.9525 17.511 17.8545 17.6813 17.6842C17.8517 17.5138 17.9497 17.2843 17.955 17.0435C17.9604 16.8027 17.8726 16.5691 17.71 16.3914L10.3222 9.00281L17.71 1.61235C17.8002 1.52635 17.8724 1.42318 17.9221 1.30889C17.9719 1.19461 17.9984 1.07152 17.9999 0.94687C18.0015 0.822218 17.9781 0.698515 17.9311 0.583033C17.8842 0.467551 17.8146 0.36262 17.7266 0.274408C17.6385 0.186196 17.5337 0.116484 17.4183 0.0693699C17.3029 0.0222553 17.1792 -0.00131087 17.0546 5.62491e-05C16.9299 0.00142337 16.8068 0.0276964 16.6925 0.077331C16.5781 0.126966 16.4749 0.19896 16.3887 0.289082V0.290956Z" fill="#0D4C8B"/>
                        </svg>
                    </button>

                    <div class="row" id="map-modal-content-{{k}}">
                        <div class="col-md-5 col-xs-12 additiona_image_background">
                            <img src="{{partner.background.path}}" alt="{{partner.instituion}} detailed image">
                            <div class="title_and_link">
                                <div class="partner_title" id="map-modal-title-{{k}}">{{partner.instituion}}</div>
                                <div class="partner_link">
                                    <a href="{{partner.instituion_url}}"
                                       class="btn btn-primary"
                                       target="_blank"
                                       rel="noopener noreferrer"
                                       aria-label="Visit {{partner.instituion}} website (opens in new window)">{{'Visit website'|_}}</a>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-7 col-xs-12 partner_detailed_info">
                            {% if insider_members.getIM(partner.id).count > 0 %}
                            <section role="region" aria-labelledby="map-members-heading-{{k}}">
                                <h3 id="map-members-heading-{{k}}">{{'Members'|_}}</h3>
                                <div class="partners_list_content">
                                    {% for profile in insider_members.getIM(partner.id) %}
                                    <article class="contact_info row" role="article" aria-labelledby="map-member-name-{{k}}-{{loop.index}}">
                                        <div class="col-md-3 col-xs-12 coordinator_image">
                                            {% if profile.avatar %}
                                            <img alt="Photo of {{ profile.names }}" src="{{profile.avatar|crop_image}}">
                                            {% else %}
                                            <img alt="Default avatar for {{ profile.names }}" src="{{ 'avatar.svg'|media }}" width="82" height="67" class="no-image">
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6 col-xs-12 coordinator_info">
                                            <div class="">
                                                <h4 id="map-member-name-{{k}}-{{loop.index}}">{{ profile.names }}</h4>
                                                {% if profile.email %}
                                                <div class="position">
                                                    <a href="mailto:{{ profile.email }}"
                                                       target="_blank"
                                                       aria-label="Send email to {{ profile.names }}">{{ profile.email }}</a>
                                                </div>
                                                {% endif %}
                                                {% if profile.position %} <div class="position">{{ profile.position }}</div>{% endif %}
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-xs-12">
                                            <p class="read-more"
                                               onclick="expandBiography(this);"
                                               aria-expanded="false"
                                               aria-controls="bio-{{k}}-{{loop.index}}"
                                               aria-label="Read biography of {{ profile.names }}">{{'Read more'|_}}</p>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="body"
                                                 id="map-bio-{{k}}-{{loop.index}}"
                                                 style="display: none;"
                                                 role="region"
                                                 aria-labelledby="map-member-name-{{k}}-{{loop.index}}">{{ profile.content|raw }}</div>
                                        </div>
                                    </article>
                                    {% endfor %}
                                </div>
                            </section>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
